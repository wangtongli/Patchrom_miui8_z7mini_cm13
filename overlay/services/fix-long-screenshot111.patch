From 17a1f3cac6b4248be9e8e0c6f50f51d395f354ed Mon Sep 17 00:00:00 2001
From: wangtongli <276792882@qq.com>
Date: Thu, 3 Nov 2016 14:44:19 +0800
Subject: [PATCH] fix long screenshot

---
 .../server/am/ActivityStackSupervisor.smali        | 25 ++++++++++++++++++++--
 1 file changed, 23 insertions(+), 2 deletions(-)

--- a/services/smali/com/android/server/am/ActivityStackSupervisor.smali
+++ b/services/smali/com/android/server/am/ActivityStackSupervisor.smali
@@ -7808,14 +7808,23 @@
     :cond_7
     if-eqz p3, :cond_8
 
-    const/4 v4, 0x4
+    const/4 v4, 0x5
 
     new-array v4, v4, [Ljava/lang/Object;
 
     move-object/from16 v0, p1
 
-    iget v5, v0, Lcom/android/server/am/ActivityRecord;->userId:I
+    iget-object v5, v0, Lcom/android/server/am/ActivityRecord;->app:Lcom/android/server/am/ProcessRecord;
+
+    if-eqz v5, :cond_miui_0
+
+    move-object/from16 v0, p1
+
+    iget-object v5, v0, Lcom/android/server/am/ActivityRecord;->app:Lcom/android/server/am/ProcessRecord;
+
+    iget v5, v5, Lcom/android/server/am/ProcessRecord;->pid:I
 
+    :goto_miui_0
     invoke-static {v5}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;
 
     move-result-object v5
@@ -7856,6 +7865,14 @@
 
     aput-object v5, v4, v6
 
+    const/4 v6, 0x4
+
+    move-object/from16 v0, p1
+
+    iget-object v5, v0, Lcom/android/server/am/ActivityRecord;->launchedFromPackage:Ljava/lang/String;
+
+    aput-object v5, v4, v6
+
     const/16 v5, 0x7536
 
     invoke-static {v5, v4}, Landroid/util/EventLog;->writeEvent(I[Ljava/lang/Object;)I
@@ -8389,6 +8406,10 @@
     const/4 v4, 0x1
 
     return v4
+    :cond_miui_0
+    const/4 v5, 0x0
+
+    goto/16 :goto_miui_0
 
     .restart local v21    # "profilerInfo":Landroid/app/ProfilerInfo;
     .restart local v28    # "profileFd":Landroid/os/ParcelFileDescriptor;
-- 
1.9.1

